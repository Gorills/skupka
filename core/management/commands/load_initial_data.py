from django.core.management.base import BaseCommand
from django.contrib.sites.models import Site
from core.models import SiteSettings, Page


class Command(BaseCommand):
    help = 'Загружает начальные данные сайта из tomsk-skupka.ru'

    def handle(self, *args, **options):
        self.stdout.write('Настройка домена сайта (django.contrib.sites)...')
        self.set_site_domain()

        self.stdout.write('Создание настроек сайта...')
        self.create_settings()

        self.stdout.write('Создание страниц...')
        self.create_pages()

        self.stdout.write(self.style.SUCCESS('Данные успешно загружены!'))

    def set_site_domain(self):
        """Устанавливает домен для SITE_ID=1 (sitemap, canonical и т.д.)."""
        Site.objects.update_or_create(
            pk=1,
            defaults={
                'domain': 'tomsk-skupka.ru',
                'name': 'Компьютеры? — скупка и ремонт техники в Томске',
            }
        )
        self.stdout.write('  Домен: tomsk-skupka.ru')

    def create_settings(self):
        SiteSettings.objects.update_or_create(
            pk=1,
            defaults={
                'site_name': 'Компьютеры?',
                'phone': '8 (953) 921-15-72',
                'phone_link': '+79539211572',
                'address': 'г.Томск, ул. Советская, д. 90',
                'working_hours': 'Ежедневно с 10:00 до 20:00',
                'whatsapp_link': 'https://wa.me/79539211572',
                'years_work': 10,
                'devices_bought': 1580,
                'devices_sold': 1705,
                'happy_clients': 3285,
                'devices_repaired': 1287,
                'footer_text': 'Разработка сайта ProfIT',
                'map_code': '<iframe src="https://yandex.ru/map-widget/v1/?um=constructor%3A5e3a8f6d8d4c3b2a1f0e9d8c7b6a5f4e3d2c1b0a&amp;source=constructor&amp;ll=84.977481%2C56.488713&amp;z=16&amp;pt=84.977481%2C56.488713" width="100%" height="400" frameborder="0" title="Карта" loading="lazy"></iframe>',
            }
        )

    def create_pages(self):
        pages_data = [
            {
                'title': 'Скупка техники в Томске',
                'slug': 'home',
                'page_type': 'home',
                'hero_title': 'Скупка техники в Томске',
                'hero_subtitle': 'Нашли где купят дороже? Дадим цену выше!',
                'content': '''<h2>О нашей компании</h2>
<p><strong>TOMSK-SKUPKA.RU</strong> - место, куда Вы можете продать свою технику и сразу же получить деньги!</p>
<p>Компания "Компьютеры?" уже очень давно занимается скупкой старой техники в Томске по самым выгодным для Вас ценам.</p>''',
                'show_in_menu': False,
                'order': 0,
                'meta_title': 'Компьютеры? - компания по ремонту и скупке техники в Томске',
                'meta_description': 'Скупка ноутбуков, компьютеров и мониторов в Томске по выгодным ценам. Выезд на дом, быстрая оценка, оплата сразу.',
                'meta_keywords': 'скупка техники Томск, продать ноутбук Томск, скупка компьютеров, скупка мониторов',
            },
            {
                'title': 'Скупка ноутбуков',
                'slug': 'skupka-noutbukov',
                'page_type': 'skupka',
                'hero_title': 'Купим ваш ноутбук дороже всех!',
                'hero_subtitle': 'Нашли где купят дороже? Дадим цену выше!',
                'advantages_title': 'Почему продать нам ноутбук это выгодно?',
                'advantage_1_title': 'Самая высокая и честная цена в Томске',
                'advantage_2_title': 'Покупаем в любом состоянии',
                'advantage_3_title': 'Покупаем разбитые или залитые',
                'advantage_4_title': 'Выезжаем на дом для оценки и покупки',
                'advantage_5_title': 'Обменяйте неработающий ноутбук на новый',
                'content': '''<h2>Хотели бы выгодно сдать ноутбук?</h2>
<p>TOMSK-SKUPKA.RU - место, куда Вы можете продать свой ноутбук и сразу же получить деньги!</p>
<p>Компания "Компьютеры?" уже очень давно занимается скупкой старой техники в Томске по самым выгодным для Вас ценам. За это время множество наших клиентов не только избавились от ненужного хлама, но и получили выгоду в виде денежного вознаграждения, либо новой техники.</p>
<p>Мы покупаем ноутбуки и предлагаем за них самую высокую цену в Томске. Стоимость выкупа может доходить до 80% от стоимости ноутбука в магазине.</p>

<h2>Ваш ноутбук сломан или неисправен?</h2>
<p>Мы скупаем ноутбуки в любом состоянии. Сломанные или залитые, это не имеет значения!</p>
<p>Дома лежит старый и ненужный ноутбук, а чинить его дорого и бессмысленно? Всегда можно сдать ноутбук на запчасти дорого, по очень выгодой цене.</p>

<h2>Как мы оцениваем технику?</h2>
<ul>
<li><strong>Модель</strong> - Мы смотрим на реальную рыночную стоимость конкретной модели ноутбука</li>
<li><strong>Техническое состояние</strong> - Чем лучше сохранился ноутбук, тем выше цена</li>
<li><strong>Наличие комплектующих</strong> - Учитывается наличие аккумулятора, зарядного устройства или даже чехла</li>
<li><strong>Механические повреждения</strong> - Наличие механических повреждений может повлиять на стоимость</li>
<li><strong>Время эксплуатации</strong> - Чем новее ноутбук, тем выше будет цена</li>
</ul>

<h2>Скупка ноутбуков в Томске</h2>
<p>Или почему стоит продать Ваш ноутбук именно нам:</p>
<ul>
<li>Быстрая оценка за 15 минут. Для этого даже не обязательно приезжать к нам в офис.</li>
<li>Самая адекватная цена на скупку ноутбуков в Томске.</li>
<li>Мы можем приехать к Вам домой, что в сегодняшних условиях очень актуально.</li>
</ul>''',
                'show_in_menu': True,
                'menu_title': 'Скупка ноутбуков',
                'order': 1,
                'meta_title': 'Скупка ноутбуков в Томске дорого - продать ноутбук дорого на запчасти',
                'meta_description': 'Скупка ноутбуков в Томске по высоким ценам. Покупаем ноутбуки в любом состоянии: рабочие, сломанные, залитые. Выезд на дом, оценка за 15 минут.',
                'meta_keywords': 'скупка ноутбуков Томск, продать ноутбук Томск, сдать ноутбук на запчасти',
            },
            {
                'title': 'Скупка компьютеров',
                'slug': 'skupka-kompyuterov',
                'page_type': 'skupka',
                'hero_title': 'Купим ваш компьютер дороже всех!',
                'hero_subtitle': 'Нашли где купят дороже? Дадим цену выше!',
                'advantages_title': 'Почему продать нам компьютер это выгодно?',
                'advantage_1_title': 'Самая высокая и честная цена в Томске',
                'advantage_2_title': 'Покупаем в любом состоянии',
                'advantage_3_title': 'Покупаем разбитые или залитые',
                'advantage_4_title': 'Выезжаем на дом для оценки и покупки',
                'advantage_5_title': 'Обменяйте неработающий компьютер на новый',
                'content': '''<h2>Скупка компьютеров в Томске</h2>
<p>Наша компания занимается скупкой компьютеров и комплектующих по самым выгодным ценам в Томске.</p>
<p>Мы покупаем как системные блоки целиком, так и отдельные комплектующие: процессоры, видеокарты, оперативную память, жесткие диски и SSD.</p>
<p>Не важно, в каком состоянии находится ваш компьютер - мы готовы его купить!</p>''',
                'show_in_menu': True,
                'menu_title': 'Скупка компьютеров',
                'order': 2,
                'meta_title': 'Скупка компьютеров в Томске дорого - продать компьютер дорого на запчасти',
                'meta_description': 'Скупка компьютеров и комплектующих в Томске. Покупаем системные блоки в любом состоянии. Выезд на дом, честная оценка.',
                'meta_keywords': 'скупка компьютеров Томск, продать компьютер Томск, скупка комплектующих',
            },
            {
                'title': 'Скупка мониторов',
                'slug': 'skupka-monitorov',
                'page_type': 'skupka',
                'hero_title': 'Купим ваш монитор дороже всех!',
                'hero_subtitle': 'Нашли где купят дороже? Дадим цену выше!',
                'advantages_title': 'Почему продать нам монитор это выгодно?',
                'advantage_1_title': 'Самая высокая и честная цена в Томске',
                'advantage_2_title': 'Покупаем в любом состоянии',
                'advantage_3_title': 'Покупаем разбитые или залитые',
                'advantage_4_title': 'Выезжаем на дом для оценки и покупки',
                'advantage_5_title': 'Обменяйте неработающий монитор на новый',
                'content': '''<h2>Скупка мониторов в Томске</h2>
<p>Продайте свой монитор нам и получите деньги сразу!</p>
<p>Мы покупаем мониторы любых производителей и любой диагонали. Рабочие мониторы оцениваем по максимальной стоимости.</p>
<p>Даже если ваш монитор сломан - мы его купим!</p>''',
                'show_in_menu': True,
                'menu_title': 'Скупка мониторов',
                'order': 3,
                'meta_title': 'Скупка мониторов в Томске дорого - продать монитор в Томске, дорого',
                'meta_description': 'Скупка мониторов в Томске. Покупаем мониторы любых производителей в любом состоянии. Высокие цены, выезд на дом.',
                'meta_keywords': 'скупка мониторов Томск, продать монитор Томск',
            },
            {
                'title': 'Ремонт ноутбуков',
                'slug': 'remont-noutbukov',
                'page_type': 'remont',
                'hero_title': 'Ремонт ноутбуков в Томске',
                'hero_subtitle': 'Нашли где дешевле? Сделаем скидку!',
                'advantages_title': 'Почему отремонтировать у нас ноутбук это выгодно?',
                'advantage_1_title': 'Самая честная цена в Томске',
                'advantage_2_title': 'Ремонтируем любые поломки',
                'advantage_3_title': 'Ремонтируем разбитые или залитые',
                'advantage_4_title': 'Выезжаем на дом',
                'advantage_5_title': 'Обменяйте неработающий ноутбук на новый',
                'content': '''<h2>Отремонтировать ноутбук в Томске</h2>
<p>Любую поломку можно починить! Даже если вы залили свой ноутбук водой или уронили его так сильно, что он разлетелся на части, не стоит отчаиваться и выбрасывать Ваш ноутбук!</p>
<p>Наши специалисты готовы взяться за ремонт ноутбука и сделать его качественно и быстро, вне зависимости от поломки и неисправности!</p>

<h2>Сервисный центр по ремонту ноутбуков в Томске</h2>
<p>Мы осуществляем срочный ремонт ноутбуков в Томске с гарантией. Ремонтируем ноутбуки в любом состоянии: разбитые, залитые, разломанные по частям.</p>
<p>Наши специалисты справятся с любыми поломками Вашего ноутбука.</p>
<p>Всегда в наличии огромное количество запчастей и расходников для ремонта. А так же для диагностики или ремонта всегда можно вызвать мастера на дом!</p>
<p>Звоните по тел: <strong>8(953) 921 15-72</strong></p>''',
                'show_in_menu': True,
                'menu_title': 'Ремонт ноутбуков',
                'order': 4,
                'meta_title': 'Ремонт ноутбуков в Томске, выезд на дом',
                'meta_description': 'Ремонт ноутбуков в Томске с гарантией. Ремонтируем любые поломки: залитые, разбитые ноутбуки. Выезд мастера на дом.',
                'meta_keywords': 'ремонт ноутбуков Томск, починить ноутбук Томск, сервисный центр ноутбуков',
            },
        ]

        for data in pages_data:
            Page.objects.update_or_create(
                slug=data['slug'],
                defaults=data
            )
            self.stdout.write(f"  Создана страница: {data['title']}")
